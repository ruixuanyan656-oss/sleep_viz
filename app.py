# app.py
import streamlit as st

# ===== ä¸­æ–‡å­—ä½“ï¼ˆåªåˆå§‹åŒ–ä¸€æ¬¡ï¼‰=====
from utils.fonts import setup_chinese_font
setup_chinese_font()

# ===== æ•°æ®åŠ è½½ =====
from utils.data import load_data

# ===== é¡µé¢é…ç½® =====
st.set_page_config(
    page_title="ç¡çœ å¥åº·æ•°æ®å¯è§†åŒ–ç³»ç»Ÿ",
    layout="wide"
)

st.title("ç¡çœ å¥åº·æ•°æ®åˆ†æä¸å¯è§†åŒ–ç³»ç»Ÿ")

# ======================================================
# æ•°æ®ä¸Šä¼ 
# ======================================================
uploaded_file = st.file_uploader(
    "è¯·ä¸Šä¼ ã€å·²å®Œæˆé¢„å¤„ç†ã€‘çš„ç¡çœ å¥åº·æ•°æ® CSV æ–‡ä»¶",
    type="csv"
)

if uploaded_file is None:
    st.info("ğŸ‘† è¯·å…ˆä¸Šä¼  CSV æ–‡ä»¶åå†è¿›è¡Œåˆ†æ")
    st.stop()

# ======================================================
# æ•°æ®åŠ è½½
# ======================================================
df = load_data(uploaded_file)
st.success(f"æ•°æ®åŠ è½½æˆåŠŸï¼Œå…± {len(df)} æ¡è®°å½•")

# ======================================================
# å›¾è¡¨é€‰æ‹©
# ======================================================
chart_map = {
    "01 èº«ä½“æ´»åŠ¨ Ã— ç¡çœ è´¨é‡": "charts.chart_01",
    "02 ç¡çœ æ—¶é•¿ Ã— ç¡çœ è´¨é‡ï¼ˆèŒä¸šï¼‰": "charts.chart_02",
    "03 æ¯æ—¥æ­¥æ•° Ã— å‹åŠ›ï¼ˆæ€§åˆ«ï¼‰": "charts.chart_03",
    "04 æ€§åˆ« Ã— ç¡çœ è´¨é‡": "charts.chart_04",
    "05 å¹´é¾„ Ã— ç¡çœ æ—¶é•¿åˆ†å¸ƒ": "charts.chart_05",
    "06 èº«ä½“æ´»åŠ¨ Ã— å¿ƒç‡": "charts.chart_06",
    "07 å¹´é¾„ Ã— ç¡çœ éšœç¢ç±»å‹": "charts.chart_07",
    "08 èº«ä½“æ´»åŠ¨ Ã— ç¡çœ è´¨é‡ï¼ˆæ°”æ³¡å›¾ï¼‰": "charts.chart_08",
    "09 ç¡çœ è´¨é‡ Ã— è¡€å‹": "charts.chart_09",
    "10 ä¸åŒèŒä¸šçš„ç¡çœ éšœç¢åˆ†å¸ƒï¼ˆç™¾åˆ†æ¯”ï¼‰": "charts.chart_10",
    "11 å‹åŠ› Ã— ç¡çœ æ—¶é•¿ Ã— ç¡çœ è´¨é‡ï¼ˆä¸‰ç»´æ°”æ³¡ï¼‰": "charts.chart_11",
    "12 BMI Ã— æ´»åŠ¨æ°´å¹³ Ã— ç¡çœ è´¨é‡ï¼ˆç®±çº¿å›¾ï¼‰": "charts.chart_12",
    "13 ç»¼åˆåˆ†æï¼ˆ2Ã—2 æ€»è§ˆï¼‰": "charts.chart_13",
}

option = st.selectbox(
    "è¯·é€‰æ‹©è¦æŸ¥çœ‹çš„å›¾è¡¨ï¼š",
    list(chart_map.keys())
)

# ======================================================
# åŠ¨æ€åŠ è½½å¹¶ç»˜å›¾ï¼ˆç»Ÿä¸€ render æ¥å£ï¼‰
# ======================================================
module_path = chart_map[option]
module = __import__(module_path, fromlist=["render"])

fig = module.render(df)

st.pyplot(fig, use_container_width=True)
